{% extends "accounts/base.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
<script type='text/javascript' src='https://cdn.yodlee.com/fastlink/v4/initialize.js'></script>

<div id="container-fastlink"></div>

{% csrf_token %}

<script>
    (function (window) {
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        var pk = "{{ user.pk }}"
        var token = "{{ token }}"
        var fastlinkBtn = document.getElementById('btn-fastlink');
        function huh() {
            window.fastlink.open({
                fastLinkURL: 'https://fl4.sandbox.yodlee.com/authenticate/restserver/fastlink',
                accessToken: `Bearer ${token}`,
                amplitude_account: "",
                params: {
                    configName : 'Verification'
                },
                onSuccess: function (data) {
                    // will be called on success. For list of possible message, refer to onSuccess(data) Method.
                    $.ajax({
                        type: 'POST',
                        url:`new_bank`,
                        data : {
                            'csrfmiddlewaretoken':csrftoken,
                            'AccountId' : data.providerAccountId,
                            'providerId' : data.providerId
                        },
                    })
                    console.log(data.providerAccountId);
                    console.log(data.providerId);
                },
                onError: function (data) {
                // will be called on error. For list of possible message, refer to onError(data) Method.
                },
                onClose: function (data) {
                // will be called called to close FastLink. For list of possible message, refer to onClose(data) Method.
                },
                onEvent: function (data) {
                // will be called on intermittent status update.
                }
            },
            'container-fastlink');
        };huh();
    }(window));
</script>


<!-- <link rel="stylesheet" href="{% static 'wallets/css/card.css' %}">
<script src="https://js.stripe.com/v3/"></script>

<div class="card text-white zarathus-card mx-auto">
    <div class="card-body">
        
        <form action="{% url 'wallets:new-bank' pk=user.pk %}" method="post" id="payment-form" autocomplete="off">
            {% csrf_token %}
            <h3 class="fw-normal text-center">{% trans "Enter your bank information" %}</h3>
            <hr class="zarathus-hr">

            {% crispy form %}

            <button type="submit" class="neon-button mb-2">{% trans "Add Bank" %}</button>
        </form>


    </div>
</div> -->
{% endblock content %}